import{V as T,M as V,O as A,a as de,C as Y,B as X,F as Z,P as ue,T as R,b as pe,L as me,E as fe,c as he,d as ye,e as W,S as K,f as we,g as F,R as ve,D as be,h as J,i as _e,W as ge,G as xe,A as Me,j as ke,k as Se}from"./three.module.407b2d1e.js";import{O as Pe}from"./OrbitControls.b8593dc7.js";import{f as Ce,a as De}from"./solarSystem.7185f838.js";import{d as Te,r as x,b as N,j as E,g as l,t as C,u as w,h as P,f as B,o as D,a6 as Q,w as I,$ as H,e as ee,B as O,F as te,p as ze,v as Ee,a7 as Oe,a8 as q}from"./vendor.94fbfd90.js";import{u as Re}from"./index.19f121b2.js";import"./index.c55ef174.js";class $e extends A{constructor(t=document.createElement("div")){super();this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new de(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&e.element.parentNode!==null&&e.element.parentNode.removeChild(e.element)})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}const $=new T,ne=new V,se=new V,oe=new T,ie=new T;class je{constructor(t={}){const e=this;let n,c,r,p;const o={objects:new WeakMap},y=t.element!==void 0?t.element:document.createElement("div");y.style.overflow="hidden",this.domElement=y,this.getSize=function(){return{width:n,height:c}},this.render=function(i,h){i.matrixWorldAutoUpdate===!0&&i.updateMatrixWorld(),h.parent===null&&h.matrixWorldAutoUpdate===!0&&h.updateMatrixWorld(),ne.copy(h.matrixWorldInverse),se.multiplyMatrices(h.projectionMatrix,ne),d(i,i,h),M(i)},this.setSize=function(i,h){n=i,c=h,r=n/2,p=c/2,y.style.width=i+"px",y.style.height=h+"px"};function d(i,h,g){if(i.isCSS2DObject){$.setFromMatrixPosition(i.matrixWorld),$.applyMatrix4(se);const u=i.visible===!0&&$.z>=-1&&$.z<=1&&i.layers.test(g.layers)===!0;if(i.element.style.display=u===!0?"":"none",u===!0){i.onBeforeRender(e,h,g);const a=i.element;a.style.transform="translate("+-100*i.center.x+"%,"+-100*i.center.y+"%)translate("+($.x*r+r)+"px,"+(-$.y*p+p)+"px)",a.parentNode!==y&&y.appendChild(a),i.onAfterRender(e,h,g)}const _={distanceToCameraSquared:b(g,i)};o.objects.set(i,_)}for(let u=0,_=i.children.length;u<_;u++)d(i.children[u],h,g)}function b(i,h){return oe.setFromMatrixPosition(i.matrixWorld),ie.setFromMatrixPosition(h.matrixWorld),oe.distanceToSquared(ie)}function k(i){const h=[];return i.traverse(function(g){g.isCSS2DObject&&h.push(g)}),h}function M(i){const h=k(i).sort(function(u,_){if(u.renderOrder!==_.renderOrder)return _.renderOrder-u.renderOrder;const a=o.objects.get(u).distanceToCameraSquared,f=o.objects.get(_).distanceToCameraSquared;return a-f}),g=h.length;for(let u=0,_=h.length;u<_;u++)h[u].element.style.zIndex=g-u}}}async function Le({numStars:s=1e4}={}){function t(){const d=Math.random()*25+5e12,b=Math.random(),k=Math.random(),M=2*Math.PI*b,i=Math.acos(2*k-1),h=d*Math.sin(i)*Math.cos(M),g=d*Math.sin(i)*Math.sin(M),u=d*Math.cos(i);return{pos:new T(h,g,u),minDist:d}}const e=[],n=[],c=[0,.1,.65];let r;for(let d=0;d<s;d+=1){const b=c[Math.floor(Math.random()*c.length)],k=t(),{pos:M}=k;r=new Y().setHSL(b,Math.random(),Math.random()),e.push(M.x,M.y,M.z),n.push(r.r,r.g,r.b)}const p=new X;p.setAttribute("position",new Z(e,3)),p.setAttribute("color",new Z(n,3));const y=await Ce({filter:[{key:"key",value:"star"}]});if(y){const d=new ue({size:.2,vertexColors:!0,map:new R().load(y.data[0].url)});return new pe(p,d)}}const L=Te("solarSystemStore",()=>{const s=x(!0),t=x(!1),e=x(!0),n=1e-4,c=x(3),r=x(!0),p=x(60),o={exposure:1,strength:1.2,threshold:.4,radius:0},y=x(null),d=x(null),b=x([]);return{realTime:r,selectedPlanetMission:y,selectedPlanet:d,displayPath:s,displayGridHelper:t,isRealScale:e,controlSpeed:c,timelapseMultiply:p,scaleDown:n,BLOOM_PARAMS:o,planets:b}});function U(s){return s*1496e5}function ae(s,t,e=1,n=.4){const c=5e3,r=L(),p=new me({color:t.color,linewidth:e,transparent:!0,opacity:n}),o=new fe(0,0,U(t.perihelion_astronomical_unit)*r.scaleDown,U(t.aphelion_astronomical_unit)*r.scaleDown,0,2*Math.PI,!1,0),y=o.getPoints(c),d=new X().setFromPoints(y),b=new he(d,p);b.rotation.x=Math.PI*.5;const k=new ye;function M(){const i=new T,h=r.realTime?k.getElapsedTime()*(1/(t.synodic_orbital_period*31536e3)):k.getElapsedTime()*(1/t.synodic_orbital_period)/r.timelapseMultiply%1;o.getPointAt(h,i),s.position.copy(i),s.position.applyMatrix4(b.matrixWorld)}return{animatedPath:M,path:b}}function Ae(s){return{all:s=s||new Map,on:function(t,e){var n=s.get(t);n?n.push(e):s.set(t,[e])},off:function(t,e){var n=s.get(t);n&&(e?n.splice(n.indexOf(e)>>>0,1):s.set(t,[]))},emit:function(t,e){var n=s.get(t);n&&n.slice().map(function(c){c(e)}),(n=s.get("*"))&&n.slice().map(function(c){c(t,e)})}}}var j=Ae();const G=L();function Be(s){const t=new A,e=new A,n=new R().load(s.texture_map),c=new R().load(s.normal_map),r=new W(new K(s.radius*G.scaleDown,264,164),s.key==="sun"?new we({map:n}):new F({map:n,normalMap:s.normal_map?c:null}));if(r.rotateZ(Math.PI/180*s.tilt),s.ring){const o=new R().load(s.ring),y=new ve(20,30,128),d=new F({map:o,side:be}),b=new W(y,d);b.rotateY(-.5*Math.PI),b.rotateX(-.4*Math.PI),e.add(b)}s.moons&&s.moons.length&&s.moons.forEach(o=>{const y=new A,d=new W(new K(o.radius*G.scaleDown,32,32),new F({map:new R().load(o.texture_map),normalMap:new R().load(o.normal_map)}));d.position.set(U(o.perihelion_astronomical_unit)*G.scaleDown,0,0);const b=new J(o.color||16777215,.2,500,0);d.add(b),y.add(d),e.add(y),le(d,d,o),ae(y,o)});let p;if(s.key!=="sun"&&(p=ae(e,s)),s.key==="sun"){const o=new J(16777215,s.luminosity*5,5e6,0);r.add(o)}le(r,e,s),e.add(r),t.add(e),G.planets.push({raw:s,bodySystemObj:t,bodySystem:e,body:r,path:p})}function le(s,t,e){const n=document.createElement("div");n.className=`${e.key} tracking-widest  uppercase cursor-pointer font-bold opacity-60`,n.innerText=e.name,n.addEventListener("pointerdown",()=>{j.emit("pin-planet",{object3d:t,planetData:e})});const c=new $e(n);c.position.copy(s.position),c.center.set(.5,1),c.layers.set(0),s.add(c)}const Ie={class:"my-2 rounded w-[inherit] h-full bg-[#39393c3a] relative"},He={class:"mx-3 py-1"},Ge={class:"flex justify-between items-center truncate"},We={class:"tracking-[8px] uppercase truncate transition-all duration-100 font-bold opacity-60"},Fe={class:"flex items-center"},Ne=N({__name:"planetMission",emits:["close"],setup(s,{emit:t}){const e=L(),n=t;function c(){n("close")}return(r,p)=>{const o=B("Icon");return D(),E("div",Ie,[l("div",He,[l("div",Ge,[l("div",We,C(w(e).selectedPlanetMission.name)+"'s Missions ",1),l("div",Fe,[P(o,{class:"scale-150 opacity-40 cursor-pointer",icon:"material-symbols:close-rounded",onClick:c})])])])])}}});const qe={class:"absolute z-10 bottom-10 left-1/2"},Ue={class:"space-y-1 -translate-x-1/2 w-max"},Ve={key:0,class:"flex justify-center space-x-1 font-bold tracking-widest truncate transition-all duration-100 opacity-60"},Ye=l("span",{class:"mr-1"},"1 year =",-1),Xe={class:"text-green-400"},Ze={class:"grid grid-cols-3 gap-7 min-h-[34px]"},Ke={class:"flex items-center justify-center"},Je={class:"absolute top-0 left-0 z-10"},Qe={class:"flex"},et={class:"flex items-center justify-between mb-1"},tt={class:"font-bold tracking-widest uppercase truncate transition-all duration-100 cursor-pointer opacity-60"},nt={class:"overflow-y-auto overflow-x-hidden space-y-1 planet-list pb-1 pr-1 max-h-[70vh]"},st=["onClick"],ot={class:"flex justify-between h-full"},it={class:"flex flex-col justify-between mx-3 my-1"},at={class:"font-bold tracking-widest cursor-pointer"},lt={class:"flex mb-1 space-x-2"},rt={class:"translate-x-1/3"},ct=["src"],dt={class:"absolute top-0 right-0 z-10"},ut={class:"m-2 space-y-1"},pt=l("div",{class:"text-right"},[l("h3",{class:"font-bold tracking-widest uppercase cursor-pointer opacity-60"}," Option ")],-1),mt=l("div",{class:"absolute z-10 bottom-1 left-1"},[l("div",{class:"italic opacity-30"},"Real time position is not supported")],-1),ft=N({__name:"navOverlay",setup(s){const{t}=Re(),e=L(),n=x(!1),c=x("minute(s)"),r=[{key:"second(s)",label:"second"},{key:"minute(s)",label:"minute"},{key:"hour(s)",label:"hour"},{key:"day(s)",label:"day"}],p=x(!0),o=x(0);Q(()=>{c.value==="minute(s)"?o.value=e.timelapseMultiply/60:c.value==="hour(s)"?o.value=e.timelapseMultiply/(60*60):c.value==="day(s)"?o.value=e.timelapseMultiply/(60*60*24):o.value=e.timelapseMultiply});function y(u){e.selectedPlanet?e.selectedPlanet.planetData.key===u.raw.key?e.selectedPlanet=null:j.emit("pin-planet",{object3d:u.bodySystem,planetData:u.raw}):j.emit("pin-planet",{object3d:u.bodySystem,planetData:u.raw})}function d(u){j.emit("move-to-planet",{object3d:u.bodySystem,planetData:u.raw})}function b(){switch(c.value){case"minute(s)":e.timelapseMultiply=e.timelapseMultiply+60;break;case"hour(s)":e.timelapseMultiply=e.timelapseMultiply+60*60;break;case"day(s)":e.timelapseMultiply=e.timelapseMultiply+60*60*24;break;default:++e.timelapseMultiply;break}}function k(){if(e.timelapseMultiply>0)switch(c.value){case"minute(s)":e.timelapseMultiply=e.timelapseMultiply-60;break;case"hour(s)":e.timelapseMultiply=e.timelapseMultiply-60*60;break;case"day(s)":e.timelapseMultiply=e.timelapseMultiply-60*60*24;break;default:--e.timelapseMultiply;break}}function M(u){switch(c.value=u,c.value){case"minute(s)":e.timelapseMultiply=o.value*60;break;case"hour(s)":e.timelapseMultiply=o.value*60*60;break;case"day(s)":e.timelapseMultiply=o.value*60*60*24;break;default:e.timelapseMultiply=o.value;break}}function i(){e.realTime=!e.realTime}function h(u,_){u.stopPropagation(),n.value=!0,e.selectedPlanetMission=_.raw}function g(){n.value=!n.value}return(u,_)=>{const a=B("n-dropdown"),f=B("Icon"),v=B("n-button");return D(),E(te,null,[l("div",qe,[l("div",Ue,[w(e).realTime?H("",!0):(D(),E("div",Ve,[Ye,l("span",Xe,C(o.value),1),P(a,{trigger:"hover",options:r,onSelect:M},{default:I(()=>[l("span",null,C(c.value),1)]),_:1})])),l("div",Ze,[l("div",null,[w(e).realTime?H("",!0):(D(),ee(v,{key:0,disabled:o.value===1||w(e).realTime,quaternary:"",class:"opacity-60 !bg-[#ffffff4d] w-min",onClick:k},{default:I(()=>[P(f,{icon:"solar:skip-previous-line-duotone"})]),_:1},8,["disabled"]))]),l("div",Ke,[l("div",{class:O(`${w(e).realTime?"bg-green-600 before:bg-green-600":"bg-blue-600 before:bg-blue-600"} rounded-full w-4 h-4 cursor-pointer before:w-6 before:h-6 before:opacity-60 before:content-[''] before:flex before:-m-1 before:rounded-full`),onClick:i},null,2)]),l("div",null,[w(e).realTime?H("",!0):(D(),ee(v,{key:0,disabled:w(e).realTime,quaternary:"",class:"opacity-60 !bg-[#ffffff4d] w-min",onClick:b},{default:I(()=>[P(f,{icon:"solar:skip-next-line-duotone"})]),_:1},8,["disabled"]))])]),l("div",{class:O(`tracking-widest text-[16px] uppercase ${w(e).realTime?"text-green-600":"text-blue-600"}   truncate transition-all duration-100 font-bold opacity-60`)},C(w(e).realTime?"Real time":"Relative time"),3)])]),l("div",Je,[l("div",Qe,[l("div",{class:O(`m-2  transition-all duration-200
       ${p.value?"w-[20vw]":"w-0"}`)},[l("div",et,[l("div",tt,C(w(t)("view.solar_system.planet_nav.title")),1),l("div",null,[P(v,{size:"small",ghost:"",class:"bg-[#39393c99] opacity-60",onClick:_[0]||(_[0]=m=>p.value=!p.value)},{default:I(()=>[P(f,{icon:p.value?"ic:baseline-keyboard-double-arrow-left":"ic:baseline-keyboard-double-arrow-right"},null,8,["icon"])]),_:1})])]),l("div",nt,[(D(!0),E(te,null,ze(w(e).planets,(m,S)=>(D(),E("div",{key:S,class:"bg-[#3a3a3d99] h-[7vh] hover:bg-[#39393c99] transition-all duration-100 rounded-sm opacity-40 hover:opacity-100 cursor-pointer",onClick:z=>d(m)},[l("div",ot,[l("div",it,[l("div",at,C(m.raw.name),1),l("div",lt,[P(f,{class:"cursor-pointer",icon:w(e).selectedPlanet&&w(e).selectedPlanet.planetData.key===m.raw.key?"solar:pin-bold":"solar:pin-broken",onClick:z=>y(m)},null,8,["icon","onClick"]),P(f,{class:"cursor-pointer",icon:"solar:satellite-linear",onClick:z=>h(z,m)},null,8,["onClick"])])]),l("div",rt,[l("img",{src:m.raw.logo,class:"h-full"},null,8,ct)])])],8,st))),128))])],2),w(e).selectedPlanetMission?(D(),E("div",{key:0,class:O(`${p.value&&n.value?"w-[50vw]":"w-0"} h-[inherit] transition-all duration-100 `)},[P(Ne,{onClose:g})],2)):H("",!0)])]),l("div",dt,[l("div",ut,[pt,l("div",{class:O(`p-2 cursor-pointer  ${w(e).displayPath?"bg-[#ffffffb0] text-black":"bg-[#ffffff33] "}`),onClick:_[1]||(_[1]=m=>w(e).displayPath=!w(e).displayPath)},C(w(e).displayPath?w(t)("view.solar_system.option.show_orbit"):w(t)("view.solar_system.option.hide_orbit")),3),l("div",{class:O(`p-2 cursor-pointer  ${w(e).displayGridHelper?"bg-[#ffffffb0] text-black":"bg-[#ffffff33] "}`),onClick:_[2]||(_[2]=m=>w(e).displayGridHelper=!w(e).displayGridHelper)},C(w(e).displayGridHelper?"Show grid":"Hide grid"),3),l("div",{class:O(`p-2 cursor-pointer  ${w(e).isRealScale?"bg-[#ffffffb0] text-black":"bg-[#ffffff33] "}`),onClick:_[3]||(_[3]=m=>w(e).isRealScale=!w(e).isRealScale)},C(w(e).isRealScale?"Real scale":"Relative scale"),3)])]),mt],64)}}}),ht={class:"relative w-full h-full"},xt=N({__name:"index",setup(s){const t=L(),e=x(null),n=new _e,c=x(null);let r,p;const o=new ge({antialias:!0,logarithmicDepthBuffer:!1}),y=new je;let d=2;const b=new xe(1e7,1e3),k=new Me(1e7),M=new ke(4210752,.2);n.add(M),Ee(async()=>{n.background=new Y("black");const a=await Le();n.add(a);const{width:f,height:v,top:m}=e.value.getBoundingClientRect();r=new Se(75,f/v,.1,1e12),r.position.set(0,8e4,8e4),o.setPixelRatio(window.devicePixelRatio),o.setSize(f,v),e.value.appendChild(o.domElement),y.setSize(f,v),y.domElement.style.position="absolute",y.domElement.style.top=m+"px",document.body.appendChild(y.domElement),p=new Pe(r,y.domElement),p.zoomSpeed=t.controlSpeed,p.panSpeed=t.controlSpeed,_(),window.addEventListener("resize",h)}),Oe(()=>{e.value.removeChild(o.domElement),document.body.removeChild(y.domElement)}),j.on("pin-planet",a=>{d=2,t.selectedPlanet=a;const{x:f,y:v,z:m}=t.selectedPlanet.object3d.position;r.position.x=f-t.selectedPlanet.planetData.radius*t.scaleDown-2,r.position.y=v+t.selectedPlanet.planetData.radius*t.scaleDown+1,r.position.z=m+t.selectedPlanet.planetData.radius*t.scaleDown+2,p.target=new T(f,v,m)}),j.on("move-to-planet",a=>{const{x:f,y:v,z:m}=a.object3d.position;r.position.x=f-a.planetData.radius*t.scaleDown-2,r.position.y=v+a.planetData.radius*t.scaleDown+1,r.position.z=m+a.planetData.radius*t.scaleDown+2,p.target=new T(f,v,m)}),Q(()=>{t.displayGridHelper?(n.add(b),n.add(k)):(n.remove(b),n.remove(k)),p&&(p.zoomSpeed=t.controlSpeed,p.panSpeed=t.controlSpeed)}),i();async function i(){const a=[],v=await De({filter:[]});v&&(v.data.forEach(m=>{if(m.mother_planet){const S=v.data.find(z=>z.key===m.mother_planet);S&&(S.moons||(S.moons=[]),S.moons.push(m))}else a.push(m)}),a.forEach(m=>{Be(m)}),t.planets.forEach(m=>{n.add(q(m.bodySystemObj)),m.path&&n.add(q(m.path.path))}))}function h(){const{width:a,height:f}=e.value.getBoundingClientRect();o.setSize(a,f)}window.addEventListener("wheel",g);function g(a){f(a)?d>2&&--d:d<10&&++d;function f(v){return v.wheelDelta?v.wheelDelta>0:v.deltaY<0}}function u(a,f){o.render(a,f),y.render(a,f)}function _(){if(c.value=requestAnimationFrame(_),p.update(),u(n,r),t.planets.length&&t.planets.forEach(a=>{a.raw.key!=="sun"&&(a.body.rotateY(t.realTime?1/(a.raw.synodic_rotation_period*84600):1/(a.raw.synodic_rotation_period*84600)/t.timelapseMultiply),a.path&&q(a.path.animatedPath()))}),t.selectedPlanet){const a=t.planets.find(ce=>ce.raw.key==="sun"),f=t.selectedPlanet.object3d.position.distanceTo(a==null?void 0:a.bodySystem.position),{x:v,y:m,z:S}=t.selectedPlanet.object3d.position,z=(f-t.selectedPlanet.planetData.radius*t.scaleDown*d)*(v/f),re=(f-t.selectedPlanet.planetData.radius*t.scaleDown*d)*(S/f);r.position.x=z,r.position.z=re,p.target=new T(v,m,S)}}return(a,f)=>(D(),E("div",ht,[l("div",{ref_key:"el",ref:e,class:"w-full h-full"},null,512),P(ft)]))}});export{xt as default};
