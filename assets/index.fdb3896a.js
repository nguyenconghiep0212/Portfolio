import{b as W,m as q,ai as X,aj as ie,a3 as j,ak as le,g as E,af as re,al as ce,ag as de,C as pe,ad as H,F as A,a6 as Y,J as ue,a2 as U,am as me,D as fe,a9 as Z,S as he,W as ye,ac as be,a8 as we,aa as ve,a as _e}from"./three.module.890a6b73.js";import{O as ge}from"./OrbitControls.7256e180.js";import{a as xe,C as ke}from"./CSS2DRenderer.f3645388.js";import{h as J}from"./index.2b4a0606.js";import{g as Me,r as w,d as F,b as C,l as n,t as S,u as i,m as M,a as P,X as K,j as O,a5 as B,i as Q,e as T,M as ee,O as Se,k as te,o as Pe,a8 as De,a9 as N}from"./vendor.d473fa58.js";import{u as Ce}from"./useI18n.312b7c39.js";import{I as R}from"./index.21343502.js";const Te=s=>J.post({url:"/api/texture-map/list-all",data:s},{isTransformResponse:!1,joinParamsToUrl:!1}),je=s=>J.post({url:"/api/planets/list-all",data:s},{isTransformResponse:!1,joinParamsToUrl:!1});async function Re({numStars:s=1e4}={}){function t(){const c=Math.random()*25+5e12,y=Math.random(),x=Math.random(),_=2*Math.PI*y,k=Math.acos(2*x-1),D=c*Math.sin(k)*Math.cos(_),$=c*Math.sin(k)*Math.sin(_),b=c*Math.cos(k);return{pos:new E(D,$,b),minDist:c}}const e=[],o=[],p=[0,.1,.65];let l;for(let c=0;c<s;c+=1){const y=p[Math.floor(Math.random()*p.length)],x=t(),{pos:_}=x;l=new W().setHSL(y,Math.random(),Math.random()),e.push(_.x,_.y,_.z),o.push(l.r,l.g,l.b)}const u=new q;u.setAttribute("position",new X(e,3)),u.setAttribute("color",new X(o,3));const h=await Te({filter:[{key:"key",value:"star"}]});if(h){const c=new ie({size:.2,vertexColors:!0,map:new j().load(h.data[0].url)});return new le(u,c)}}const L=Me("solarSystemStore",()=>{const s=w(!0),t=w(!1),e=w(!0),o=1e-4,p=w(3),l=w(!0),u=w(60),a={exposure:1,strength:1.2,threshold:.4,radius:0},h=w(null),c=w(null),y=w([]);return{realTime:l,selectedPlanetMission:h,selectedPlanet:c,displayPath:s,displayGridHelper:t,isRealScale:e,controlSpeed:p,timelapseMultiply:u,scaleDown:o,BLOOM_PARAMS:a,planets:y}});function V(s){return s*1496e5}function se(s,t,e=1,o=.4){const p=5e3,l=L(),u=new re({color:t.color,linewidth:e,transparent:!0,opacity:o}),a=new ce(0,0,V(t.perihelion_astronomical_unit)*l.scaleDown,V(t.aphelion_astronomical_unit)*l.scaleDown,0,2*Math.PI,!1,0),h=a.getPoints(p),c=new q().setFromPoints(h),y=new de(c,u);y.rotation.x=Math.PI*.5;const x=new pe;function _(){const k=new E,D=l.realTime?x.getElapsedTime()*(1/(t.synodic_orbital_period*31536e3)):x.getElapsedTime()*(1/t.synodic_orbital_period)/l.timelapseMultiply%1;a.getPointAt(D,k),s.position.copy(k),s.position.applyMatrix4(y.matrixWorld)}return{animatedPath:_,path:y}}function ze(s){return{all:s=s||new Map,on:function(t,e){var o=s.get(t);o?o.push(e):s.set(t,[e])},off:function(t,e){var o=s.get(t);o&&(e?o.splice(o.indexOf(e)>>>0,1):s.set(t,[]))},emit:function(t,e){var o=s.get(t);o&&o.slice().map(function(p){p(e)}),(o=s.get("*"))&&o.slice().map(function(p){p(t,e)})}}}var z=ze();const I=L();function $e(s){const t=new H,e=new H,o=new j().load(s.texture_map),p=new j().load(s.normal_map),l=new A(new Y(s.radius*I.scaleDown,264,164),s.key==="sun"?new ue({map:o}):new U({map:o,normalMap:s.normal_map?p:null}));if(l.rotateZ(Math.PI/180*s.tilt),s.ring){const a=new j().load(s.ring),h=new me(20,30,128),c=new U({map:a,side:fe}),y=new A(h,c);y.rotateY(-.5*Math.PI),y.rotateX(-.4*Math.PI),e.add(y)}s.moons&&s.moons.length&&s.moons.forEach(a=>{const h=new H,c=new A(new Y(a.radius*I.scaleDown,32,32),new U({map:new j().load(a.texture_map),normalMap:new j().load(a.normal_map)}));c.position.set(V(a.perihelion_astronomical_unit)*I.scaleDown,0,0);const y=new Z(a.color||16777215,.2,500,0);c.add(y),h.add(c),e.add(h),oe(c,c,a),se(h,a)});let u;if(s.key!=="sun"&&(u=se(e,s)),s.key==="sun"){const a=new Z(16777215,s.luminosity*5,5e6,0);l.add(a)}oe(l,e,s),e.add(l),t.add(e),I.planets.push({raw:s,bodySystemObj:t,bodySystem:e,body:l,path:u})}function oe(s,t,e){const o=document.createElement("div");o.className=`${e.key} tracking-widest  uppercase cursor-pointer text-bold opacity-60`,o.innerText=e.name,o.addEventListener("pointerdown",()=>{z.emit("pin-planet",{object3d:t,planetData:e})});const p=new xe(o);p.position.copy(s.position),p.center.set(.5,1),p.layers.set(0),s.add(p)}const Ee={class:"my-2 rounded w-[inherit] h-full bg-[#39393c3a] relative"},Le={class:"mx-3 py-1"},Oe={class:"flex justify-between items-center truncate"},Be={class:"tracking-[8px] uppercase truncate transition-all duration-100 text-bold opacity-60"},Ie={class:"flex items-center"},Ge=F({__name:"planetMission",emits:["close"],setup(s,{emit:t}){const e=L(),o=t;function p(){o("close")}return(l,u)=>(P(),C("div",Ee,[n("div",Le,[n("div",Oe,[n("div",Be,S(i(e).selectedPlanetMission.name)+"'s Missions ",1),n("div",Ie,[M(i(R),{class:"scale-150 opacity-40 cursor-pointer",icon:"material-symbols:close-rounded",onClick:p})])])])]))}});const He={class:"absolute bottom-10 left-1/2 z-10"},Ae={class:"-translate-x-1/2 w-max space-y-1"},Ue={key:0,class:"flex justify-center tracking-widest truncate transition-all duration-100 text-bold opacity-60 space-x-1"},Fe=n("span",{class:"mr-1"},"1 year =",-1),Ne={class:"text-green-400"},Ve={class:"grid grid-cols-3 gap-7 min-h-[34px]"},We={class:"flex justify-center items-center"},qe={class:"absolute top-0 left-0 z-10"},Xe={class:"flex"},Ye={class:"flex items-center justify-between mb-1"},Ze={class:"tracking-widest uppercase truncate transition-all duration-100 cursor-pointer text-bold opacity-60"},Je={class:"overflow-y-auto overflow-x-hidden space-y-1 planet-list pb-1 pr-1 max-h-[70vh]"},Ke=["onClick"],Qe={class:"flex justify-between h-full"},et={class:"mx-3 my-1 flex flex-col justify-between"},tt={class:"tracking-widest cursor-pointer text-bold"},st={class:"flex space-x-2 mb-1"},ot={class:"translate-x-1/3"},nt=["src"],at={class:"absolute top-0 right-0 z-10"},it={class:"m-2 space-y-1"},lt=n("div",{class:"text-right"},[n("h3",{class:"tracking-widest uppercase cursor-pointer text-bold opacity-60"}," Option ")],-1),rt=n("div",{class:"absolute z-10 bottom-1 left-1"},[n("div",{class:"opacity-30 italic"}," Real time position is not supported ")],-1),ct=F({__name:"navOverlay",setup(s){const{t}=Ce(),e=L(),o=w(!1),p=w("minute(s)"),l=[{key:"second(s)",label:"second"},{key:"minute(s)",label:"minute"},{key:"hour(s)",label:"hour"},{key:"day(s)",label:"day"}],u=w(!0),a=w(0);K(()=>{p.value==="minute(s)"?a.value=e.timelapseMultiply/60:p.value==="hour(s)"?a.value=e.timelapseMultiply/(60*60):p.value==="day(s)"?a.value=e.timelapseMultiply/(60*60*24):a.value=e.timelapseMultiply});function h(b){e.selectedPlanet?e.selectedPlanet.planetData.key===b.raw.key?e.selectedPlanet=null:z.emit("pin-planet",{object3d:b.bodySystem,planetData:b.raw}):z.emit("pin-planet",{object3d:b.bodySystem,planetData:b.raw})}function c(b){z.emit("move-to-planet",{object3d:b.bodySystem,planetData:b.raw})}function y(){switch(p.value){case"minute(s)":e.timelapseMultiply=e.timelapseMultiply+60;break;case"hour(s)":e.timelapseMultiply=e.timelapseMultiply+60*60;break;case"day(s)":e.timelapseMultiply=e.timelapseMultiply+60*60*24;break;default:++e.timelapseMultiply;break}}function x(){if(e.timelapseMultiply>0)switch(p.value){case"minute(s)":e.timelapseMultiply=e.timelapseMultiply-60;break;case"hour(s)":e.timelapseMultiply=e.timelapseMultiply-60*60;break;case"day(s)":e.timelapseMultiply=e.timelapseMultiply-60*60*24;break;default:--e.timelapseMultiply;break}}function _(b){switch(p.value=b,p.value){case"minute(s)":e.timelapseMultiply=a.value*60;break;case"hour(s)":e.timelapseMultiply=a.value*60*60;break;case"day(s)":e.timelapseMultiply=a.value*60*60*24;break;default:e.timelapseMultiply=a.value;break}}function k(){e.realTime=!e.realTime}function D(b,v){b.stopPropagation(),o.value=!0,e.selectedPlanetMission=v.raw}function $(){o.value=!o.value}return(b,v)=>{const r=te("n-dropdown"),m=te("n-button");return P(),C(ee,null,[n("div",He,[n("div",Ae,[i(e).realTime?B("",!0):(P(),C("div",Ue,[Fe,n("span",Ne,S(a.value),1),M(r,{trigger:"hover",options:l,onSelect:_},{default:O(()=>[n("span",null,S(p.value),1)]),_:1})])),n("div",Ve,[n("div",null,[i(e).realTime?B("",!0):(P(),Q(m,{key:0,disabled:a.value===1||i(e).realTime,quaternary:"",class:"opacity-60 !bg-[#ffffff4d] w-min",onClick:x},{default:O(()=>[M(i(R),{icon:"solar:skip-previous-line-duotone"})]),_:1},8,["disabled"]))]),n("div",We,[n("div",{class:T(`${i(e).realTime?"bg-green-600 before:bg-green-600":"bg-blue-600 before:bg-blue-600"} rounded-full w-4 h-4 cursor-pointer before:w-6 before:h-6 before:opacity-60 before:content-[''] before:flex before:-m-1 before:rounded-full`),onClick:k},null,2)]),n("div",null,[i(e).realTime?B("",!0):(P(),Q(m,{key:0,disabled:i(e).realTime,quaternary:"",class:"opacity-60 !bg-[#ffffff4d] w-min",onClick:y},{default:O(()=>[M(i(R),{icon:"solar:skip-next-line-duotone"})]),_:1},8,["disabled"]))])]),n("div",{class:T(`tracking-widest text-[16px] uppercase ${i(e).realTime?"text-green-600":"text-blue-600"} font-thin truncate transition-all duration-100 text-bold opacity-60`)},S(i(e).realTime?"Real time":"Relative time"),3)])]),n("div",qe,[n("div",Xe,[n("div",{class:T(`m-2  transition-all duration-200
       ${u.value?"w-[20vw]":"w-0"}`)},[n("div",Ye,[n("div",Ze,S(i(t)("view.solar_system.planet_nav.title")),1),n("div",null,[M(m,{size:"small",ghost:"",class:"bg-[#39393c99] opacity-60",onClick:v[0]||(v[0]=d=>u.value=!u.value)},{default:O(()=>[M(i(R),{icon:u.value?"ic:baseline-keyboard-double-arrow-left":"ic:baseline-keyboard-double-arrow-right"},null,8,["icon"])]),_:1})])]),n("div",Je,[(P(!0),C(ee,null,Se(i(e).planets,(d,f)=>(P(),C("div",{key:f,class:"bg-[#3a3a3d99] h-[7vh] hover:bg-[#39393c99] transition-all duration-100 rounded-sm opacity-40 hover:opacity-100 cursor-pointer",onClick:g=>c(d)},[n("div",Qe,[n("div",et,[n("div",tt,S(d.raw.name),1),n("div",st,[M(i(R),{class:"cursor-pointer",icon:i(e).selectedPlanet&&i(e).selectedPlanet.planetData.key===d.raw.key?"solar:pin-bold":"solar:pin-broken",onClick:g=>h(d)},null,8,["icon","onClick"]),M(i(R),{class:"cursor-pointer",icon:"solar:satellite-linear",onClick:g=>D(g,d)},null,8,["onClick"])])]),n("div",ot,[n("img",{src:d.raw.logo,class:"h-full"},null,8,nt)])])],8,Ke))),128))])],2),i(e).selectedPlanetMission?(P(),C("div",{key:0,class:T(`${u.value&&o.value?"w-[50vw]":"w-0"} h-[inherit] transition-all duration-100 `)},[M(Ge,{onClose:$})],2)):B("",!0)])]),n("div",at,[n("div",it,[lt,n("div",{class:T(`p-2 cursor-pointer  ${i(e).displayPath?"bg-[#ffffffb0] text-black":"bg-[#ffffff33] "}`),onClick:v[1]||(v[1]=d=>i(e).displayPath=!i(e).displayPath)},S(i(e).displayPath?i(t)("view.solar_system.option.show_orbit"):i(t)("view.solar_system.option.hide_orbit")),3),n("div",{class:T(`p-2 cursor-pointer  ${i(e).displayGridHelper?"bg-[#ffffffb0] text-black":"bg-[#ffffff33] "}`),onClick:v[2]||(v[2]=d=>i(e).displayGridHelper=!i(e).displayGridHelper)},S(i(e).displayGridHelper?"Show grid":"Hide grid"),3),n("div",{class:T(`p-2 cursor-pointer  ${i(e).isRealScale?"bg-[#ffffffb0] text-black":"bg-[#ffffff33] "}`),onClick:v[3]||(v[3]=d=>i(e).isRealScale=!i(e).isRealScale)},S(i(e).isRealScale?"Real scale":"Relative scale"),3)])]),rt],64)}}}),dt={class:"relative w-full h-full"},wt=F({__name:"index",setup(s){const t=L(),e=w(null),o=new he,p=w(null);let l,u;const a=new ye({antialias:!0,logarithmicDepthBuffer:!1}),h=new ke;let c=2;const y=new be(1e7,1e3),x=new we(1e7),_=new ve(4210752,.2);o.add(_),Pe(async()=>{o.background=new W("black");const r=await Re();o.add(r);const{width:m,height:d,top:f}=e.value.getBoundingClientRect();l=new _e(75,m/d,.1,1e12),l.position.set(0,8e4,8e4),a.setPixelRatio(window.devicePixelRatio),a.setSize(m,d),e.value.appendChild(a.domElement),h.setSize(m,d),h.domElement.style.position="absolute",h.domElement.style.top=f+"px",document.body.appendChild(h.domElement),u=new ge(l,h.domElement),u.zoomSpeed=t.controlSpeed,u.panSpeed=t.controlSpeed,v(),window.addEventListener("resize",D)}),De(()=>{location.reload()}),z.on("pin-planet",r=>{c=2,t.selectedPlanet=r;const{x:m,y:d,z:f}=t.selectedPlanet.object3d.position;l.position.x=m-t.selectedPlanet.planetData.radius*t.scaleDown-2,l.position.y=d+t.selectedPlanet.planetData.radius*t.scaleDown+1,l.position.z=f+t.selectedPlanet.planetData.radius*t.scaleDown+2,u.target=new E(m,d,f)}),z.on("move-to-planet",r=>{const{x:m,y:d,z:f}=r.object3d.position;l.position.x=m-r.planetData.radius*t.scaleDown-2,l.position.y=d+r.planetData.radius*t.scaleDown+1,l.position.z=f+r.planetData.radius*t.scaleDown+2,u.target=new E(m,d,f)}),K(()=>{t.displayGridHelper?(o.add(y),o.add(x)):(o.remove(y),o.remove(x)),u&&(u.zoomSpeed=t.controlSpeed,u.panSpeed=t.controlSpeed)}),k();async function k(){const r=[],d=await je({filter:[]});d&&(d.data.forEach(f=>{if(f.mother_planet){const g=d.data.find(G=>G.key===f.mother_planet);g&&(g.moons||(g.moons=[]),g.moons.push(f))}else r.push(f)}),r.forEach(f=>{$e(f)}),t.planets.forEach(f=>{o.add(N(f.bodySystemObj)),f.path&&o.add(N(f.path.path))}))}function D(){const{width:r,height:m}=e.value.getBoundingClientRect();a.setSize(r,m)}window.addEventListener("wheel",$);function $(r){m(r)?c>2&&--c:c<10&&++c;function m(d){return d.wheelDelta?d.wheelDelta>0:d.deltaY<0}}function b(r,m){a.render(r,m),h.render(r,m)}function v(){if(p.value=requestAnimationFrame(v),u.update(),b(o,l),t.planets.length&&t.planets.forEach(r=>{r.raw.key!=="sun"&&(r.body.rotateY(t.realTime?1/(r.raw.synodic_rotation_period*84600):1/(r.raw.synodic_rotation_period*84600)/t.timelapseMultiply),r.path&&N(r.path.animatedPath()))}),t.selectedPlanet){const r=t.planets.find(ae=>ae.raw.key==="sun"),m=t.selectedPlanet.object3d.position.distanceTo(r==null?void 0:r.bodySystem.position),{x:d,y:f,z:g}=t.selectedPlanet.object3d.position,G=(m-t.selectedPlanet.planetData.radius*t.scaleDown*c)*(d/m),ne=(m-t.selectedPlanet.planetData.radius*t.scaleDown*c)*(g/m);l.position.x=G,l.position.z=ne,u.target=new E(d,f,g)}}return(r,m)=>(P(),C("div",dt,[n("div",{ref_key:"el",ref:e,class:"w-full h-full"},null,512),M(ct)]))}});export{wt as default};
